<!doctype html>
<html lang="en"><head><meta charset="utf-8"><title>Image Context d2031f813bf2463d</title>
<style>
body{font:14px/1.4 -apple-system,Segoe UI,Roboto,sans-serif;max-width:900px;margin:24px auto;padding:0 16px;color:#222}
h1{font-size:18px;margin:0 0 12px 0}
h2{font-size:16px;margin:16px 0 8px}
h3{font-size:14px;margin:10px 0 4px}
code,pre{background:#f6f8fa;padding:2px 4px;border-radius:4px}
figure{margin:10px 0;padding:8px;border:1px solid #e6e6e6;border-radius:8px}
figcaption{color:#555;font-size:12px;margin-top:6px}
pre {
  white-space: pre-wrap;     /* allow wrapping inside <pre> */
  overflow-wrap: anywhere;   /* break very long words/URLs */
  word-break: break-word;    /* fallback for older engines */
  max-width: 68ch;           /* ~68 characters line length */
  margin: 0 auto 10px;       /* center the block */
  line-height: 1.5;
}

figcaption {
  max-width: 68ch;           /* keep the sentence narrow */
  margin: 6px auto 0;        /* center under the image */
  white-space: normal;       /* ensure wrapping */
  overflow-wrap: anywhere;
  word-break: break-word;
  line-height: 1.5;
}
</style>
</head><body>
  <h1>Image context</h1>
  <p><strong>Search input:</strong></p>
  <pre>Ornamental surface</pre>
  <p><strong>Search mode:</strong> words &nbsp; <strong>Targeting:</strong> 1.5×</p>

  <h2>Selected image</h2>
  <figure>
    <img src="https://pd12m.s3.us-west-2.amazonaws.com/images/2b89b0b4-8dbe-5fc7-aa22-1aaf055749d4.jpeg" alt="" style="max-width:100%;height:auto;">
    <figcaption>Region surface — drawing, undress, annotated, flesh, centerfold, disrobing, margin, torso</figcaption>
  </figure>

  <h2>All regions</h2>
  <section style="margin:16px 0;"><h3 style="margin:6px 0;">Region ornamental — sermonizing, monstrance, rosary, apostolic, reliquary, holy, communion, christened, amen, archdiocese, novena, crucifix, catholic, annunciation, evensong, sacristy, saintly, sermonizing, christened, apostolic, annunciation, rosary, saintly, catholic, saint, crucifix, amen, evensong, communion, archdiocese, saintly, archdiocese, novena, nun, curia, saint, pontificate, catholic, friar, monstrance, rosary, christened, mutter, divine, archdiocese, novena, reliquary, apostolic, christened, saint, curia, mutter, monstrance, holy, saintly, penance, rosary, catholic, holiest, pontificate, vocation, sacrilege, archdiocese, catholic, friar, christened, saintly, religiously, christened, sacrilege, theology, blaspheme, holy, amen, saintly, penance, nun, holiest, convent, curia, archdiocese, sacristy, saintly, annunciation, principality, holiest, monstrance, pontificate, reliquary, apostolic, crucifix, saint, penance, pontificate, christened, principality, curia, convent, holiest, holy, religion, catholic, archdiocese, novena, theology, sacristy, saintly, annunciation, rosary, curia, apostolic, vocation, catholic, crucifix, evensong, fresco, sacristy, saintly, archdiocese, novena, cloister, convent, curia, christened, archdiocese, novena, embellished, friar, catholic, nun, cloister, saintly, holy, vocation, annunciation, saint, rosary, evensong, saintly, amen, christened, catholic, archdiocese, novena, rosary, apostolic, saintly, evensong, communion, saint, catholic, amen, christened, archdiocese, apostolic, evensong, amen, christened, apostolic, saintly, archdiocese, friar, communion, saintly, evensong, apostolic, sermonizing, sacrilege, christened, annunciation, archdiocese, renaissance, evensong, curia, reliquary, annunciation, theology, crucifix, lent, penance, apostolic, sacristy, saintly, communion, catholic, monstrance, holiest, christened, apostolic, annunciation, saintly, theology, archdiocese, amen, evensong, annunciation, apostolic, christened, amen, archdiocese, catholic, saintly, evensong, apostolic, catholic, communion, sacristy, saintly, annunciation, archdiocese, amen, christened, evensong, convent, fresco, evensong, sacristy, saintly, amen, christened, holy, communion, catholic, archdiocese, novena, annunciation, apostolic, reliquary, rosary, annunciation, christened, amen, saintly, apostolic, evensong, archdiocese</h3><ul style="margin:6px 0 0 18px;"><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/1587e184-16b6-5e93-aa9e-695b35876873.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/1587e184-16b6-5e93-aa9e-695b35876873.jpeg</a> — sermonizing, monstrance, rosary, apostolic, reliquary, holy, communion, christened, amen, archdiocese, novena, crucifix, catholic, annunciation, evensong, sacristy, saintly</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/d9fbd707-1d38-57e9-ada2-e12a801c178b.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/d9fbd707-1d38-57e9-ada2-e12a801c178b.jpeg</a> — sermonizing, christened, apostolic, annunciation, rosary, saintly, catholic, saint, crucifix, amen, evensong, communion, archdiocese</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/6d44fd38-154e-5919-82b5-eff281fd5b49.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/6d44fd38-154e-5919-82b5-eff281fd5b49.jpeg</a> — saintly, archdiocese, novena, nun, curia, saint, pontificate, catholic, friar, monstrance, rosary, christened, mutter</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/89e31a99-64bf-5118-9f3b-c87a8bfc9e90.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/89e31a99-64bf-5118-9f3b-c87a8bfc9e90.jpeg</a> — divine, archdiocese, novena, reliquary, apostolic, christened, saint, curia, mutter, monstrance, holy, saintly, penance, rosary, catholic, holiest</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/f788fb02-4677-5cea-a0d5-d948064c9ea5.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/f788fb02-4677-5cea-a0d5-d948064c9ea5.jpeg</a> — pontificate, vocation, sacrilege, archdiocese, catholic, friar, christened, saintly</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/85241e99-0911-5627-978a-e83c868a099d.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/85241e99-0911-5627-978a-e83c868a099d.jpeg</a> — religiously, christened, sacrilege, theology, blaspheme, holy, amen, saintly, penance, nun, holiest</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/89113d0e-4555-58b6-9c46-d32221e479ef.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/89113d0e-4555-58b6-9c46-d32221e479ef.jpeg</a> — convent, curia, archdiocese, sacristy, saintly, annunciation, principality, holiest, monstrance, pontificate, reliquary, apostolic, crucifix</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/91507b9d-6ef0-53c3-b761-e91a7f90d39e.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/91507b9d-6ef0-53c3-b761-e91a7f90d39e.jpeg</a> — saint, penance, pontificate, christened, principality, curia, convent, holiest, holy, religion, catholic, archdiocese, novena, theology, sacristy, saintly</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/ea0c1730-153f-5577-96a9-4089e133196f.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/ea0c1730-153f-5577-96a9-4089e133196f.jpeg</a> — annunciation, rosary, curia, apostolic, vocation, catholic, crucifix, evensong, fresco, sacristy, saintly, archdiocese, novena, cloister</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/4055782e-936e-573c-9a88-6faa8263b570.png" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/4055782e-936e-573c-9a88-6faa8263b570.png</a> — convent, curia, christened, archdiocese, novena, embellished, friar, catholic, nun, cloister, saintly, holy, vocation, annunciation, saint, rosary</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/1b129444-8b40-5de6-a5d0-214b9670e998.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/1b129444-8b40-5de6-a5d0-214b9670e998.jpeg</a> — evensong, saintly, amen, christened, catholic, archdiocese, novena, rosary, apostolic</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/b91addc9-5c9a-5678-afea-7311147648dc.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/b91addc9-5c9a-5678-afea-7311147648dc.jpeg</a> — saintly, evensong, communion, saint, catholic, amen, christened, archdiocese, apostolic</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/ace2a04e-76f7-5cda-95c0-41dce969da36.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/ace2a04e-76f7-5cda-95c0-41dce969da36.jpeg</a> — evensong, amen, christened, apostolic, saintly, archdiocese, friar</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/23b09eb1-744e-5b23-a713-9b19a252b4e8.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/23b09eb1-744e-5b23-a713-9b19a252b4e8.jpeg</a> — communion, saintly, evensong, apostolic, sermonizing, sacrilege, christened, annunciation</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/c49dd997-3d31-54fd-870d-6d5d1b9987b6.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/c49dd997-3d31-54fd-870d-6d5d1b9987b6.jpeg</a> — archdiocese, renaissance, evensong, curia, reliquary, annunciation, theology, crucifix, lent, penance, apostolic, sacristy, saintly, communion, catholic, monstrance, holiest</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/6e1e8bd6-128b-515d-bdc7-01e816018abd.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/6e1e8bd6-128b-515d-bdc7-01e816018abd.jpeg</a> — christened, apostolic, annunciation, saintly, theology, archdiocese, amen, evensong</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/0fec3f64-5f4e-50d3-8325-7c66c7a86cf3.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/0fec3f64-5f4e-50d3-8325-7c66c7a86cf3.jpeg</a> — annunciation, apostolic, christened, amen, archdiocese, catholic, saintly, evensong</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/fb04eda4-7283-5eda-aca8-29e2798da679.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/fb04eda4-7283-5eda-aca8-29e2798da679.jpeg</a> — apostolic, catholic, communion, sacristy, saintly, annunciation, archdiocese, amen, christened, evensong, convent</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/5926d986-e705-5681-975a-96785b4d5b35.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/5926d986-e705-5681-975a-96785b4d5b35.jpeg</a> — fresco, evensong, sacristy, saintly, amen, christened, holy, communion, catholic, archdiocese, novena, annunciation, apostolic</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/d404d3eb-7ea2-57ec-825f-2ca44eeb04dc.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/d404d3eb-7ea2-57ec-825f-2ca44eeb04dc.jpeg</a> — reliquary, rosary, annunciation, christened, amen, saintly, apostolic, evensong, archdiocese</li></ul></section>
<section style="margin:16px 0;"><h3 style="margin:6px 0;">Region surface — disrobing, margin, centerfold, annotated, torso, undress, flesh, drawing, drawing, undress, annotated, flesh, centerfold, disrobing, margin, torso, playboy, artwork, disrobing, curating, sculpture, torso, eroticism, curating, disrobing, torso, undress, artwork, sculpture, torso, eroticism, centerfold, psyche, puck, contortionist, drawing, playboy, undress, psyche, puck, torso, prude, tanning, seductive, disrobing, torso, psyche, tanning, sculpture, centerfold, undress, booby, seductive, drawing, annotated, guidebook, bordello, centerfold, margin, photocopied, torso, disrobing, secrecy, undress, sculpture, disrobing, torso, undress, secrecy, psyche, torso, centerfold, photocopied, drawing, contortionist, sculpture, centerfold, guidebook, disrobing, torso, alfresco, psyche, sculpture, upholstery, torso, centerfold, tanning, centerfold, torso, undress, upholstery, tanning, undress, centerfold, stripy, torso, artwork, undress, stripy, centerfold, seductive, torso, disrobing, disrobing, signed, drawing, torso, seductive, undress, signed, disrobing, torso, undress, seductive, drawing, eroticism, disrobing, torso, prude, undress, booby, centerfold, centerfold, alfresco, bordello, torso, tanning, sculpture, disrobing</h3><ul style="margin:6px 0 0 18px;"><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/b1699e37-9ff0-5540-affb-6a21162a4211.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/b1699e37-9ff0-5540-affb-6a21162a4211.jpeg</a> — disrobing, margin, centerfold, annotated, torso, undress, flesh, drawing</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/2b89b0b4-8dbe-5fc7-aa22-1aaf055749d4.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/2b89b0b4-8dbe-5fc7-aa22-1aaf055749d4.jpeg</a> — drawing, undress, annotated, flesh, centerfold, disrobing, margin, torso</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/72c94fc9-e57f-5e95-b086-c4d4dcbe6ef4.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/72c94fc9-e57f-5e95-b086-c4d4dcbe6ef4.jpeg</a> — playboy, artwork, disrobing, curating, sculpture, torso</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/ace00bf3-227c-57ba-809c-1fc25588812e.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/ace00bf3-227c-57ba-809c-1fc25588812e.jpeg</a> — eroticism, curating, disrobing, torso, undress, artwork, sculpture</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/186e9dd4-5617-54cc-ac37-e40bd800266b.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/186e9dd4-5617-54cc-ac37-e40bd800266b.jpeg</a> — torso, eroticism, centerfold, psyche, puck, contortionist, drawing, playboy</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/f158d9fe-e250-5023-b4f5-9b0021e65723.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/f158d9fe-e250-5023-b4f5-9b0021e65723.jpeg</a> — undress, psyche, puck, torso, prude, tanning, seductive, disrobing</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/964515bf-b24c-547f-bc1b-51db3d1cd151.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/964515bf-b24c-547f-bc1b-51db3d1cd151.jpeg</a> — torso, psyche, tanning, sculpture, centerfold, undress, booby, seductive</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/ee66b1c9-60cf-580a-8630-e3e8bae18f64.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/ee66b1c9-60cf-580a-8630-e3e8bae18f64.jpeg</a> — drawing, annotated, guidebook, bordello, centerfold, margin, photocopied</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/254a631f-ced2-5237-9ed1-2d6a6a12be30.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/254a631f-ced2-5237-9ed1-2d6a6a12be30.jpeg</a> — torso, disrobing, secrecy, undress, sculpture</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/1ac79ad2-db90-5bb8-a649-9e7479ccdf48.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/1ac79ad2-db90-5bb8-a649-9e7479ccdf48.jpeg</a> — disrobing, torso, undress, secrecy, psyche</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/48c8f8da-7b4d-5930-98ce-52850a682f7a.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/48c8f8da-7b4d-5930-98ce-52850a682f7a.jpeg</a> — torso, centerfold, photocopied, drawing, contortionist</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/3b8434ef-b860-5685-9263-17e000d44b4f.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/3b8434ef-b860-5685-9263-17e000d44b4f.jpeg</a> — sculpture, centerfold, guidebook, disrobing, torso, alfresco</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/5b378388-fe67-5dd0-9e4c-bd56ea2a0367.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/5b378388-fe67-5dd0-9e4c-bd56ea2a0367.jpeg</a> — psyche, sculpture, upholstery, torso, centerfold, tanning</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/bae0abbd-8fbf-512e-a27f-e82427ac672c.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/bae0abbd-8fbf-512e-a27f-e82427ac672c.jpeg</a> — centerfold, torso, undress, upholstery, tanning</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/b228cb44-a51f-520a-aa05-b2068bb0b2fd.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/b228cb44-a51f-520a-aa05-b2068bb0b2fd.jpeg</a> — undress, centerfold, stripy, torso, artwork</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/2d550310-5fe6-5a39-ae0f-5b6a280d7965.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/2d550310-5fe6-5a39-ae0f-5b6a280d7965.jpeg</a> — undress, stripy, centerfold, seductive, torso, disrobing</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/d800b798-24cd-5bd4-8113-f4842ec8d2e5.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/d800b798-24cd-5bd4-8113-f4842ec8d2e5.jpeg</a> — disrobing, signed, drawing, torso, seductive, undress</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/e6919c6d-b205-5a3f-93ff-8093f736ae14.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/e6919c6d-b205-5a3f-93ff-8093f736ae14.jpeg</a> — signed, disrobing, torso, undress, seductive, drawing</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/b2405f8e-b18c-5338-b26d-7484f09fc7a6.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/b2405f8e-b18c-5338-b26d-7484f09fc7a6.jpeg</a> — eroticism, disrobing, torso, prude, undress, booby, centerfold</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/d2c86568-2703-52eb-a43f-f47693b8a7e8.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/d2c86568-2703-52eb-a43f-f47693b8a7e8.jpeg</a> — centerfold, alfresco, bordello, torso, tanning, sculpture, disrobing</li></ul></section>
<style>
  /* Region dropdowns */
  details.region {
    margin: 16px 0;
    border: 1px solid #e6e6e6;
    border-radius: 10px;
    padding: 8px 10px;
    background: #fff;
  }
  details.region > summary {
    cursor: pointer;
    font-weight: 600;
    list-style: none;
    outline: none;
  }
  details.region > summary::-webkit-details-marker { display: none; }
  details.region[open] > summary { margin-bottom: 8px; }

  /* Secondary (inline preview) dropdowns under each link */
  details.secondary {
    margin-top: 6px;
    border-left: 3px solid #e6e6e6;
    padding-left: 10px;
  }
  details.secondary > summary {
    cursor: pointer;
    font-size: 12px;
    color: #444;
    list-style: none;
    outline: none;
  }
  details.secondary > summary::-webkit-details-marker { display: none; }

  .secondary-status {
    font-size: 12px;
    color: #666;
    margin: 6px 0;
  }
  .secondary-embed {
    border: 1px solid #eee;
    border-radius: 8px;
    padding: 8px;
    overflow: auto;
    max-height: 70vh;
    background: #fafafa;
  }
  details.region ul { padding-left: 0; }
  details.region li {
    list-style: none;
    display: flex;
    gap: 10px;
    align-items: flex-start;
    margin: 10px 0;
  }

  a.thumb-link { display: inline-block; }
  img.thumb {
    display: block;
    width: 140px;          /* tweak as desired */
    height: auto;
    border: 1px solid #e6e6e6;
    border-radius: 10px;
    background: #fff;
  }

  /* If you want the caption text to wrap nicely next to the thumb */
  .thumb-caption {
    line-height: 1.25;
  }
</style>

<script>
(() => {
  /**
   * Controls behaviour:
   * - If true: when a REGION opens, prefetch all secondary HTML previews in that region.
   * - If false (default): only fetch when the per-link “Inline preview” dropdown is opened
   *   (still satisfies “only when region is expanded”, because you can’t open the preview otherwise).
   */
  const PRELOAD_ON_REGION_OPEN = false;

  // Consider a link “secondary HTML” if it ends with .html/.htm/.xhtml
  // OR if you explicitly mark it with class="secondary-link" or data-secondary="1".
  const SECONDARY_RE = /\.(?:xhtml|html?|htm)(?:[?#].*)?$/i;
  const IMG_RE = /\.(?:png|jpe?g|gif|webp|svg)(?:[?#].*)?$/i;

  // Cache fetches so repeated opens don't refetch the same page.
  const fetchCache = new Map(); // url -> Promise<string>

  function hydrateImageThumbnails(regionDetails) {
  const anchors = Array.from(regionDetails.querySelectorAll("a[href]"));

  for (const a of anchors) {
    const href = a.getAttribute("href") || "";
    if (!IMG_RE.test(href)) continue;

    // If already an image (e.g., you manually made one), skip.
    if (a.querySelector("img")) continue;

    // Make the link open the full image in a new tab (optional but usually nicer)
    a.target = "_blank";
    a.rel = "noopener";
    a.classList.add("thumb-link");

    // Preserve any trailing text after the link (your " — tags" etc.)
    // by wrapping it into a span so layout stays clean.
    const li = a.closest("li");
    if (li) {
      // Everything after the <a> currently sits as text nodes in the <li>.
      // We'll keep it, but wrap it so it sits next to the image neatly.
      // Only do this once.
      if (!li.querySelector(":scope > .thumb-caption")) {
        const caption = document.createElement("div");
        caption.className = "thumb-caption";

        // Move all nodes after <a> into caption
        let node = a.nextSibling;
        while (node) {
          const next = node.nextSibling;
          caption.appendChild(node);
          node = next;
        }
        li.appendChild(caption);
      }
    }

    // Replace link text with an <img> thumbnail.
    a.textContent = ""; // removes the URL/filename display

    const img = document.createElement("img");
    img.className = "thumb";
    img.loading = "lazy";
    img.decoding = "async";

    // Alt from filename (basic)
    try {
      const u = new URL(href, window.location.href);
      img.alt = (u.pathname.split("/").pop() || "image").replace(/[-_]/g, " ");
    } catch {
      img.alt = "image";
    }

    // Critical: only set src when region is open (this function is called on open)
    img.src = href;

    a.appendChild(img);
  }
}


  function fetchText(url) {
    if (!fetchCache.has(url)) {
      fetchCache.set(url, fetch(url, { cache: "force-cache" }).then(r => {
        if (!r.ok) throw new Error(`HTTP ${r.status}`);
        return r.text();
      }));
    }
    return fetchCache.get(url);
  }

  function extractForEmbed(htmlText) {
    const parser = new DOMParser();
    const doc = parser.parseFromString(htmlText, "text/html");

    // Remove scripts for safety and to avoid side-effects.
    doc.querySelectorAll("script").forEach(s => s.remove());

    // Collect inline <style> blocks.
    const styles = Array.from(doc.querySelectorAll("style"))
      .map(s => s.textContent || "")
      .join("\n");

    // Remove styles/links from body so they don't pollute the parent page.
    doc.body.querySelectorAll("style, link[rel='stylesheet']").forEach(n => n.remove());

    return { styles, content: doc.body.innerHTML, title: doc.title || "" };
  }

  function isSecondaryLink(a) {
    const href = a.getAttribute("href") || "";
    if (!href) return false;
    if (IMG_RE.test(href)) return false;

    return (
      SECONDARY_RE.test(href) ||
      a.dataset.secondary === "1" ||
      a.classList.contains("secondary-link")
    );
  }

  function ensureSecondaryPreviewUI(a) {
    const li = a.closest("li");
    if (!li) return;
    if (li.querySelector(":scope > details.secondary")) return;

    const href = a.getAttribute("href");

    const details = document.createElement("details");
    details.className = "secondary";

    // Minimal UI; embed area is filled on demand.
    details.innerHTML = `
      <summary>Inline preview</summary>
      <div class="secondary-status">Not loaded.</div>
      <div class="secondary-embed" data-href="${href.replace(/"/g, "&quot;")}"></div>
    `;

    li.appendChild(details);

    details.addEventListener("toggle", async () => {
      if (!details.open) return;

      const embed = details.querySelector(".secondary-embed");
      if (!embed || embed.dataset.loaded === "1") return;

      // Important: only load if the enclosing region is open (your requirement).
      const region = details.closest("details.region");
      if (!region || !region.open) return;

      const status = details.querySelector(".secondary-status");
      const url = embed.dataset.href;

      try {
        status.textContent = "Loading…";
        const htmlText = await fetchText(url);
        const { styles, content } = extractForEmbed(htmlText);

        // Shadow DOM isolates the embedded page's CSS so it doesn't leak into the parent.
        if (embed.attachShadow) {
          const root = embed.attachShadow({ mode: "open" });
          root.innerHTML = `
            <style>
              :host { display: block; }
              /* light reset inside the embedded view */
              body { margin: 0; }
            </style>
            <style>${styles}</style>
            <div class="embedded">${content}</div>
          `;
        } else {
          // Fallback: no isolation (older browsers).
          embed.innerHTML = `<div class="embedded">${content}</div>`;
        }

        embed.dataset.loaded = "1";
        status.textContent = "Loaded.";
      } catch (err) {
        status.textContent = `Failed to load (${url}): ${err.message || err}`;
      }
    });
  }

  function convertRegionSectionsToDetails() {
    document.querySelectorAll("section").forEach(sec => {
      const h3 = sec.querySelector(":scope > h3");
      const ul = sec.querySelector(":scope > ul");
      if (!h3 || !ul) return;

      const title = (h3.textContent || "").trim();
      if (!/^Region\b/i.test(title)) return;

      const details = document.createElement("details");
      details.className = "region";
      if (sec.getAttribute("style")) details.setAttribute("style", sec.getAttribute("style"));

      const summary = document.createElement("summary");
      summary.textContent = title;

      const body = document.createElement("div");
      body.className = "region-body";

      // Move <ul> into the dropdown body.
      body.appendChild(ul);

      details.appendChild(summary);
      details.appendChild(body);

      // Replace the entire section (drops the old h3).
      sec.replaceWith(details);
    });
  }

  async function onRegionOpen(regionDetails) {
  if (regionDetails.dataset.hydrated === "1") return;
  regionDetails.dataset.hydrated = "1";

  // NEW: turn image links into thumbnails (only loads now, on open)
  hydrateImageThumbnails(regionDetails);

  // Keep your existing HTML-inline-preview behaviour (if you still want it)
  const anchors = Array.from(regionDetails.querySelectorAll("a[href]"))
    .filter(isSecondaryLink);

  anchors.forEach(ensureSecondaryPreviewUI);

  if (PRELOAD_ON_REGION_OPEN) { /* unchanged */ }
}


  document.addEventListener("DOMContentLoaded", () => {
    convertRegionSectionsToDetails();

    document.querySelectorAll("details.region").forEach(d => {
      d.addEventListener("toggle", () => {
        if (d.open) onRegionOpen(d);
      });
    });
  });
})();
</script>

</body></html>
