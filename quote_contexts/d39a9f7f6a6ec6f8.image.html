<!doctype html>
<html lang="en"><head><meta charset="utf-8"><title>Image Context d39a9f7f6a6ec6f8</title>
<style>
body{font:14px/1.4 -apple-system,Segoe UI,Roboto,sans-serif;max-width:900px;margin:24px auto;padding:0 16px;color:#222}
h1{font-size:18px;margin:0 0 12px 0}
h2{font-size:16px;margin:16px 0 8px}
h3{font-size:14px;margin:10px 0 4px}
code,pre{background:#f6f8fa;padding:2px 4px;border-radius:4px}
figure{margin:10px 0;padding:8px;border:1px solid #e6e6e6;border-radius:8px}
figcaption{color:#555;font-size:12px;margin-top:6px}
pre {
  white-space: pre-wrap;     /* allow wrapping inside <pre> */
  overflow-wrap: anywhere;   /* break very long words/URLs */
  word-break: break-word;    /* fallback for older engines */
  max-width: 68ch;           /* ~68 characters line length */
  margin: 0 auto 10px;       /* center the block */
  line-height: 1.5;
}

figcaption {
  max-width: 68ch;           /* keep the sentence narrow */
  margin: 6px auto 0;        /* center under the image */
  white-space: normal;       /* ensure wrapping */
  overflow-wrap: anywhere;
  word-break: break-word;
  line-height: 1.5;
}
</style>
</head><body>
  <h1>Image context</h1>
  <p><strong>Search input:</strong></p>
  <pre>Following the trajectory of Semper, where a most original ornament is posed to be one that connects structure to ornament let's take that perspective towards architecture. The first architectural example that comes to mind to illustrate an interplay between structure, skin and ornament is the Centre Pompidou, where the structure is ornamentalised and exteriorised, with the skin sitting as a membrane between them. Of course this is as much a decorative move of extended labour as the many figures listed at the beginning, but the difference is that they communicate something different, more of this time, which is why it is not seen as superficial decoration. It does exactly what semper highlights, in that for this decoration to work it connects the communication of structure and normally internalised aspects and brings them to the surface of the skin, whilst maintaining a connection.</pre>
  <p><strong>Search mode:</strong> paragraph_v &nbsp; <strong>Targeting:</strong> 4×</p>

  <h2>Selected image</h2>
  <figure>
    <img src="https://pd12m.s3.us-west-2.amazonaws.com/images/a1e50216-d5be-5f16-9f39-6fb1f90b649a.jpeg" alt="" style="max-width:100%;height:auto;">
    <figcaption>Region 0 — futurism, spanning, atrium, architecturally, louver, superstructure, structuring, concourse</figcaption>
  </figure>

  <h2>All regions</h2>
  <section style="margin:16px 0;"><h3 style="margin:6px 0;">Region 0 — ladder, structuring, backstairs, multilevel, superstructure, trellis, architecturally, bracket, futurism, spanning, atrium, architecturally, louver, superstructure, structuring, concourse, atrium, multilevel, roofless, louver, backstairs, trellis, architecturally, ladder, triptych, stereo, soundscapes, projection, experiment, darkroom, atelier, triptych, darkroom, soundscapes, seating, installation, gearing, experiment, automatise, sorter, radiometer, disassemble, seating, installation, paneling, menorah, parquetry, parquetry, louver, constructing, spanning, abattoir, structuring, superstructure, concourse, operation, experiment, sorter, abattoir, centrifuge, process, arbor, bracket, digitizing, trellis, transom, seating, louver, imprisoning, roofless, superstructure, yurt, biosphere, transom, paneling, arbor, triptych, trellis, stereo, architecturally, skyscraper, ark, biosphere, installation, imprisoning, atrium, taller, superstructure, architecturally, futurism, skyscraper, constructing, process, architecturally, vocational, structuring, digitizing, yurt, soundscapes, atelier, experiment, centrifuge, biosphere, experiment, louver, sorter, gasket, radiometer, triptych, darkroom, projection, shoemaker, soundscapes, stereo, architecturally, superstructure, proposed, structuring, cad, proposed, cad, digitizing, structuring, architecturally</h3><ul style="margin:6px 0 0 18px;"><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/3d2ff5af-471a-57e0-80a4-7aa46bb951be.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/3d2ff5af-471a-57e0-80a4-7aa46bb951be.jpeg</a> — ladder, structuring, backstairs, multilevel, superstructure, trellis, architecturally, bracket</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/a1e50216-d5be-5f16-9f39-6fb1f90b649a.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/a1e50216-d5be-5f16-9f39-6fb1f90b649a.jpeg</a> — futurism, spanning, atrium, architecturally, louver, superstructure, structuring, concourse</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/9949cced-27b8-53a3-bb99-25abb260aca1.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/9949cced-27b8-53a3-bb99-25abb260aca1.jpeg</a> — atrium, multilevel, roofless, louver, backstairs, trellis, architecturally, ladder</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/26762024-99f4-56be-b055-133861998705.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/26762024-99f4-56be-b055-133861998705.jpeg</a> — triptych, stereo, soundscapes, projection, experiment, darkroom</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/e02ee97d-dd9f-50ca-bd95-6f993aae4a38.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/e02ee97d-dd9f-50ca-bd95-6f993aae4a38.jpeg</a> — atelier, triptych, darkroom, soundscapes, seating, installation</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/74da2394-d8fa-5861-9907-896a0a03c815.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/74da2394-d8fa-5861-9907-896a0a03c815.jpeg</a> — gearing, experiment, automatise, sorter, radiometer, disassemble</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/296b9f84-800a-5b80-ba20-ca9befd56024.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/296b9f84-800a-5b80-ba20-ca9befd56024.jpeg</a> — seating, installation, paneling, menorah, parquetry</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/3b5581f9-acab-5ffb-ae49-1efc1e4c7b8c.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/3b5581f9-acab-5ffb-ae49-1efc1e4c7b8c.jpeg</a> — parquetry, louver, constructing, spanning, abattoir, structuring, superstructure, concourse</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/5fc65e8f-8af8-5b27-a6c3-251b25b743d5.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/5fc65e8f-8af8-5b27-a6c3-251b25b743d5.jpeg</a> — operation, experiment, sorter, abattoir, centrifuge, process</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/87831820-1fa1-5c1e-8264-3578e244894f.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/87831820-1fa1-5c1e-8264-3578e244894f.jpeg</a> — arbor, bracket, digitizing, trellis, transom, seating</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/fcc09da3-bcb3-5878-85c2-fe4fd65c4b20.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/fcc09da3-bcb3-5878-85c2-fe4fd65c4b20.jpeg</a> — louver, imprisoning, roofless, superstructure, yurt, biosphere</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/cfb1cb17-8dc1-5a80-a85b-0698286add1a.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/cfb1cb17-8dc1-5a80-a85b-0698286add1a.jpeg</a> — transom, paneling, arbor, triptych, trellis, stereo</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/c54590cf-dd5a-50cc-a7f8-4331730fb50b.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/c54590cf-dd5a-50cc-a7f8-4331730fb50b.jpeg</a> — architecturally, skyscraper, ark, biosphere, installation, imprisoning, atrium</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/d313f1fc-4e1e-595e-820b-734526c604f9.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/d313f1fc-4e1e-595e-820b-734526c604f9.jpeg</a> — taller, superstructure, architecturally, futurism, skyscraper, constructing</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/c46b5981-d247-5ab3-a3fb-4587018aebbb.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/c46b5981-d247-5ab3-a3fb-4587018aebbb.jpeg</a> — process, architecturally, vocational, structuring, digitizing</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/cd326da5-c909-50b7-8184-23afab8d0247.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/cd326da5-c909-50b7-8184-23afab8d0247.jpeg</a> — yurt, soundscapes, atelier, experiment, centrifuge, biosphere</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/974fc261-73d7-512b-96d3-47b2b8437c6f.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/974fc261-73d7-512b-96d3-47b2b8437c6f.jpeg</a> — experiment, louver, sorter, gasket, radiometer</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/3425a9c6-a089-504f-b67f-31b337e34cfa.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/3425a9c6-a089-504f-b67f-31b337e34cfa.jpeg</a> — triptych, darkroom, projection, shoemaker, soundscapes, stereo</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/c81f94e2-6ead-5543-a70f-5f3993ee81ba.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/c81f94e2-6ead-5543-a70f-5f3993ee81ba.jpeg</a> — architecturally, superstructure, proposed, structuring, cad</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/771dcddc-a56c-563d-a3dd-a1e997db02e9.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/771dcddc-a56c-563d-a3dd-a1e997db02e9.jpeg</a> — proposed, cad, digitizing, structuring, architecturally</li></ul></section>
<section style="margin:16px 0;"><h3 style="margin:6px 0;">Region 1 — rectilinear, splitting, numbering, schematic, notation, jig, crosshatched, diagramming, perimeter, eigenvector, crosshatched, tracing, binding, rectilinear, notation, perimeter, hypercube, manoeuvrings, trajectory, dynamo, eigenvector, plotting, gyroscope, warp, trajectory, encircles, gyroscope, tracing, untangling, trawling, manoeuvrings, hypercube, fragmenting, plywood, materialise, tessellated, canopy, sequence, semaphore, series, numbering, genealogical, lace, untangling, tessellated, encircles, materialise, semaphore, genealogical, typology, sequence, series, typology, table, facilitation, iterating, plywood, plotting, diagramming, facilitation, buzzword, tallying, dispersion, dither, iterating, fragmenting, fixture, table, splitting, tallying, visualizer, dynamo, acoustical, canopy, tracing, segmentation, dither, crosshatched, eigenvector, dispersion, algorithmic, trawling, impeller, tracing, plotting, lace, schematic, jig, warp, acoustical, rectilinear, buzzword, segmentation, multiprocessor, diagramming, crosshatched, fixture, tessellated, binding, aerodynamically, materialise, dynamo, impeller, numbering, envelope, stapling, tallying</h3><ul style="margin:6px 0 0 18px;"><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/d24fe9c1-2b37-598a-91ec-c059800eee5b.png" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/d24fe9c1-2b37-598a-91ec-c059800eee5b.png</a> — rectilinear, splitting, numbering, schematic, notation, jig, crosshatched, diagramming, perimeter</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/b590dc6a-c384-58da-a7e7-8118e46c1627.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/b590dc6a-c384-58da-a7e7-8118e46c1627.jpeg</a> — eigenvector, crosshatched, tracing, binding, rectilinear, notation, perimeter, hypercube</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/ece1209c-00d4-5e62-a90e-db1111add6e4.png" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/ece1209c-00d4-5e62-a90e-db1111add6e4.png</a> — manoeuvrings, trajectory, dynamo, eigenvector, plotting, gyroscope, warp</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/83172bd8-17f0-5ad5-97fb-85ae70c014ff.png" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/83172bd8-17f0-5ad5-97fb-85ae70c014ff.png</a> — trajectory, encircles, gyroscope, tracing, untangling, trawling, manoeuvrings</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/02ae0001-04f6-5caa-8b3b-1d8e6695248b.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/02ae0001-04f6-5caa-8b3b-1d8e6695248b.jpeg</a> — hypercube, fragmenting, plywood, materialise, tessellated, canopy</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/5a547cfa-d93b-53bd-8381-9b0b0bbbd454.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/5a547cfa-d93b-53bd-8381-9b0b0bbbd454.jpeg</a> — sequence, semaphore, series, numbering, genealogical</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/4f019b6d-0a8e-5b80-a09e-4f0eb6d0d85b.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/4f019b6d-0a8e-5b80-a09e-4f0eb6d0d85b.jpeg</a> — lace, untangling, tessellated, encircles, materialise</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/043eff3c-bc19-5dbb-8b91-a550ed3a2143.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/043eff3c-bc19-5dbb-8b91-a550ed3a2143.jpeg</a> — semaphore, genealogical, typology, sequence, series</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/2a9734ec-ccbe-566e-9d0b-7f2148d6bbc5.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/2a9734ec-ccbe-566e-9d0b-7f2148d6bbc5.jpeg</a> — typology, table, facilitation, iterating, plywood</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/e3b78bd8-bcf7-545a-9f97-69ee09defea9.png" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/e3b78bd8-bcf7-545a-9f97-69ee09defea9.png</a> — plotting, diagramming, facilitation, buzzword, tallying</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/2e92021e-f77f-5ad3-b75a-57c140696689.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/2e92021e-f77f-5ad3-b75a-57c140696689.jpeg</a> — dispersion, dither, iterating, fragmenting</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/7e54f555-7c0e-596f-a207-8760a8305b0d.png" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/7e54f555-7c0e-596f-a207-8760a8305b0d.png</a> — fixture, table, splitting, tallying</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/64558f87-b237-5acc-80a8-7adb2fa97edf.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/64558f87-b237-5acc-80a8-7adb2fa97edf.jpeg</a> — visualizer, dynamo, acoustical, canopy</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/dba1bf4d-4506-5a2e-8576-7923cdee73d5.png" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/dba1bf4d-4506-5a2e-8576-7923cdee73d5.png</a> — tracing, segmentation, dither, crosshatched, eigenvector, dispersion, algorithmic</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/3585ebce-d52c-5af8-92ea-35b7b52f5424.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/3585ebce-d52c-5af8-92ea-35b7b52f5424.jpeg</a> — trawling, impeller, tracing, plotting, lace, schematic</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/7176b61b-e56d-5819-a49d-c610ba16e27d.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/7176b61b-e56d-5819-a49d-c610ba16e27d.jpeg</a> — jig, warp, acoustical, rectilinear</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/db820e9d-b19b-5105-85cf-737098d2257b.png" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/db820e9d-b19b-5105-85cf-737098d2257b.png</a> — buzzword, segmentation, multiprocessor, diagramming</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/252343aa-01cc-5e75-bf4f-274230c19022.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/252343aa-01cc-5e75-bf4f-274230c19022.jpeg</a> — crosshatched, fixture, tessellated, binding</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/d1fc64a6-7ede-5052-ab35-1bd6f3b00640.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/d1fc64a6-7ede-5052-ab35-1bd6f3b00640.jpeg</a> — aerodynamically, materialise, dynamo, impeller</li><li><a href="https://pd12m.s3.us-west-2.amazonaws.com/images/d15aeec5-fca6-57b7-9c91-0a95a18fc736.jpeg" target="_blank">https://pd12m.s3.us-west-2.amazonaws.com/images/d15aeec5-fca6-57b7-9c91-0a95a18fc736.jpeg</a> — numbering, envelope, stapling, tallying</li></ul></section>
<style>
  /* Region dropdowns */
  details.region {
    margin: 16px 0;
    border: 1px solid #e6e6e6;
    border-radius: 10px;
    padding: 8px 10px;
    background: #fff;
  }
  details.region > summary {
    cursor: pointer;
    font-weight: 600;
    list-style: none;
    outline: none;
  }
  details.region > summary::-webkit-details-marker { display: none; }
  details.region[open] > summary { margin-bottom: 8px; }

  /* Secondary (inline preview) dropdowns under each link */
  details.secondary {
    margin-top: 6px;
    border-left: 3px solid #e6e6e6;
    padding-left: 10px;
  }
  details.secondary > summary {
    cursor: pointer;
    font-size: 12px;
    color: #444;
    list-style: none;
    outline: none;
  }
  details.secondary > summary::-webkit-details-marker { display: none; }

  .secondary-status {
    font-size: 12px;
    color: #666;
    margin: 6px 0;
  }
  .secondary-embed {
    border: 1px solid #eee;
    border-radius: 8px;
    padding: 8px;
    overflow: auto;
    max-height: 70vh;
    background: #fafafa;
  }
  details.region ul { padding-left: 0; }
  details.region li {
    list-style: none;
    display: flex;
    gap: 10px;
    align-items: flex-start;
    margin: 10px 0;
  }

  a.thumb-link { display: inline-block; }
  img.thumb {
    display: block;
    width: 140px;          /* tweak as desired */
    height: auto;
    border: 1px solid #e6e6e6;
    border-radius: 10px;
    background: #fff;
  }

  /* If you want the caption text to wrap nicely next to the thumb */
  .thumb-caption {
    line-height: 1.25;
  }
</style>

<script>
(() => {
  /**
   * Controls behaviour:
   * - If true: when a REGION opens, prefetch all secondary HTML previews in that region.
   * - If false (default): only fetch when the per-link “Inline preview” dropdown is opened
   *   (still satisfies “only when region is expanded”, because you can’t open the preview otherwise).
   */
  const PRELOAD_ON_REGION_OPEN = false;

  // Consider a link “secondary HTML” if it ends with .html/.htm/.xhtml
  // OR if you explicitly mark it with class="secondary-link" or data-secondary="1".
  const SECONDARY_RE = /\.(?:xhtml|html?|htm)(?:[?#].*)?$/i;
  const IMG_RE = /\.(?:png|jpe?g|gif|webp|svg)(?:[?#].*)?$/i;

  // Cache fetches so repeated opens don't refetch the same page.
  const fetchCache = new Map(); // url -> Promise<string>

  function hydrateImageThumbnails(regionDetails) {
  const anchors = Array.from(regionDetails.querySelectorAll("a[href]"));

  for (const a of anchors) {
    const href = a.getAttribute("href") || "";
    if (!IMG_RE.test(href)) continue;

    // If already an image (e.g., you manually made one), skip.
    if (a.querySelector("img")) continue;

    // Make the link open the full image in a new tab (optional but usually nicer)
    a.target = "_blank";
    a.rel = "noopener";
    a.classList.add("thumb-link");

    // Preserve any trailing text after the link (your " — tags" etc.)
    // by wrapping it into a span so layout stays clean.
    const li = a.closest("li");
    if (li) {
      // Everything after the <a> currently sits as text nodes in the <li>.
      // We'll keep it, but wrap it so it sits next to the image neatly.
      // Only do this once.
      if (!li.querySelector(":scope > .thumb-caption")) {
        const caption = document.createElement("div");
        caption.className = "thumb-caption";

        // Move all nodes after <a> into caption
        let node = a.nextSibling;
        while (node) {
          const next = node.nextSibling;
          caption.appendChild(node);
          node = next;
        }
        li.appendChild(caption);
      }
    }

    // Replace link text with an <img> thumbnail.
    a.textContent = ""; // removes the URL/filename display

    const img = document.createElement("img");
    img.className = "thumb";
    img.loading = "lazy";
    img.decoding = "async";

    // Alt from filename (basic)
    try {
      const u = new URL(href, window.location.href);
      img.alt = (u.pathname.split("/").pop() || "image").replace(/[-_]/g, " ");
    } catch {
      img.alt = "image";
    }

    // Critical: only set src when region is open (this function is called on open)
    img.src = href;

    a.appendChild(img);
  }
}


  function fetchText(url) {
    if (!fetchCache.has(url)) {
      fetchCache.set(url, fetch(url, { cache: "force-cache" }).then(r => {
        if (!r.ok) throw new Error(`HTTP ${r.status}`);
        return r.text();
      }));
    }
    return fetchCache.get(url);
  }

  function extractForEmbed(htmlText) {
    const parser = new DOMParser();
    const doc = parser.parseFromString(htmlText, "text/html");

    // Remove scripts for safety and to avoid side-effects.
    doc.querySelectorAll("script").forEach(s => s.remove());

    // Collect inline <style> blocks.
    const styles = Array.from(doc.querySelectorAll("style"))
      .map(s => s.textContent || "")
      .join("\n");

    // Remove styles/links from body so they don't pollute the parent page.
    doc.body.querySelectorAll("style, link[rel='stylesheet']").forEach(n => n.remove());

    return { styles, content: doc.body.innerHTML, title: doc.title || "" };
  }

  function isSecondaryLink(a) {
    const href = a.getAttribute("href") || "";
    if (!href) return false;
    if (IMG_RE.test(href)) return false;

    return (
      SECONDARY_RE.test(href) ||
      a.dataset.secondary === "1" ||
      a.classList.contains("secondary-link")
    );
  }

  function ensureSecondaryPreviewUI(a) {
    const li = a.closest("li");
    if (!li) return;
    if (li.querySelector(":scope > details.secondary")) return;

    const href = a.getAttribute("href");

    const details = document.createElement("details");
    details.className = "secondary";

    // Minimal UI; embed area is filled on demand.
    details.innerHTML = `
      <summary>Inline preview</summary>
      <div class="secondary-status">Not loaded.</div>
      <div class="secondary-embed" data-href="${href.replace(/"/g, "&quot;")}"></div>
    `;

    li.appendChild(details);

    details.addEventListener("toggle", async () => {
      if (!details.open) return;

      const embed = details.querySelector(".secondary-embed");
      if (!embed || embed.dataset.loaded === "1") return;

      // Important: only load if the enclosing region is open (your requirement).
      const region = details.closest("details.region");
      if (!region || !region.open) return;

      const status = details.querySelector(".secondary-status");
      const url = embed.dataset.href;

      try {
        status.textContent = "Loading…";
        const htmlText = await fetchText(url);
        const { styles, content } = extractForEmbed(htmlText);

        // Shadow DOM isolates the embedded page's CSS so it doesn't leak into the parent.
        if (embed.attachShadow) {
          const root = embed.attachShadow({ mode: "open" });
          root.innerHTML = `
            <style>
              :host { display: block; }
              /* light reset inside the embedded view */
              body { margin: 0; }
            </style>
            <style>${styles}</style>
            <div class="embedded">${content}</div>
          `;
        } else {
          // Fallback: no isolation (older browsers).
          embed.innerHTML = `<div class="embedded">${content}</div>`;
        }

        embed.dataset.loaded = "1";
        status.textContent = "Loaded.";
      } catch (err) {
        status.textContent = `Failed to load (${url}): ${err.message || err}`;
      }
    });
  }

  function convertRegionSectionsToDetails() {
    document.querySelectorAll("section").forEach(sec => {
      const h3 = sec.querySelector(":scope > h3");
      const ul = sec.querySelector(":scope > ul");
      if (!h3 || !ul) return;

      const title = (h3.textContent || "").trim();
      if (!/^Region\b/i.test(title)) return;

      const details = document.createElement("details");
      details.className = "region";
      if (sec.getAttribute("style")) details.setAttribute("style", sec.getAttribute("style"));

      const summary = document.createElement("summary");
      summary.textContent = title;

      const body = document.createElement("div");
      body.className = "region-body";

      // Move <ul> into the dropdown body.
      body.appendChild(ul);

      details.appendChild(summary);
      details.appendChild(body);

      // Replace the entire section (drops the old h3).
      sec.replaceWith(details);
    });
  }

  async function onRegionOpen(regionDetails) {
  if (regionDetails.dataset.hydrated === "1") return;
  regionDetails.dataset.hydrated = "1";

  // NEW: turn image links into thumbnails (only loads now, on open)
  hydrateImageThumbnails(regionDetails);

  // Keep your existing HTML-inline-preview behaviour (if you still want it)
  const anchors = Array.from(regionDetails.querySelectorAll("a[href]"))
    .filter(isSecondaryLink);

  anchors.forEach(ensureSecondaryPreviewUI);

  if (PRELOAD_ON_REGION_OPEN) { /* unchanged */ }
}


  document.addEventListener("DOMContentLoaded", () => {
    convertRegionSectionsToDetails();

    document.querySelectorAll("details.region").forEach(d => {
      d.addEventListener("toggle", () => {
        if (d.open) onRegionOpen(d);
      });
    });
  });
})();
</script>

</body></html>
